<!DOCTYPE html>
<html lang="id" class="transition-colors duration-300">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pembayaran Modern</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi Tailwind CSS untuk dark mode dan custom colors
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        },
                        secondary: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75'
                        },
                        accent: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Keyframes untuk Animasi Masuk (fade-in) */
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Keyframes untuk Animasi Muncul (fade-up) */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Keyframes untuk Animasi Keluar (fade-out) */
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        /* Toggle Switch Animation */
        @keyframes toggleSlide {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(100%);
            }
        }

        /* Gradient Animation */
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Icon Image Styles */
        .icon-campus {
            object-fit: contain;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.1));
            transition: all 0.3s ease;
        }

        .icon-profile {
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .icon-profile:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        /* Error state for images */
        .icon-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            text-align: center;
        }

        /* Kelas untuk menerapkan animasi */
        .animate-slide-in-down {
            animation: slideInDown 0.5s ease-out forwards;
        }
        .animate-fade-up {
            animation: fadeUp 0.6s ease-out forwards;
            opacity: 0;
        }
        .animate-fade-out {
            animation: fadeOut 0.5s ease-in forwards;
        }
        .animate-gradient {
            background-size: 200% 200%;
            animation: gradientShift 6s ease infinite;
        }

        /* Styling tambahan untuk modal, agar transisinya halus */
        .modal-active {
            opacity: 1 !important;
            transform: scale(1) !important;
            pointer-events: auto !important;
        }
        
        /* Mobile-specific modal adjustments */
        @media (max-width: 640px) {
            .modal-active {
                transform: scale(1) translateY(0) !important;
            }
            
            #paymentModal, #confirmModal {
                align-items: flex-end !important;
                padding: 0 !important;
            }
            
            #paymentModal > div, #confirmModal > div {
                border-radius: 1rem 1rem 0 0 !important;
                max-width: 100% !important;
                width: 100% !important;
                margin-bottom: 0 !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
        }
        
        /* Custom scrollbar untuk mobile */
        @media (max-width: 768px) {
            .table-container {
                scrollbar-width: thin;
            }
            
            .table-container::-webkit-scrollbar {
                height: 6px;
            }
            
            .table-container::-webkit-scrollbar-track {
                @apply bg-gray-100 dark:bg-gray-700;
                border-radius: 3px;
            }
            
            .table-container::-webkit-scrollbar-thumb {
                @apply bg-gray-300 dark:bg-gray-600;
                border-radius: 3px;
            }
        }
        
        /* Improved touch targets for mobile */
        @media (max-width: 768px) {
            input[type="radio"] {
                width: 20px !important;
                height: 20px !important;
            }
            
            .payment-method-label {
                min-height: 48px !important;
                padding: 12px !important;
            }
        }
        
        /* Mobile typography scaling */
        @media (max-width: 640px) {
            .mobile-title {
                font-size: 2rem !important;
                line-height: 2.25rem !important;
            }
            
            .mobile-subtitle {
                font-size: 0.875rem !important;
            }
        }

        /* Dark mode specific styles */
        .dark .bg-gradient-light {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
        }

        /* Light mode specific styles */
        .bg-gradient-light {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 25%, #f3e8ff 50%, #e0e7ff 75%, #dbeafe 100%);
        }

        /* Styling untuk font Inter */
        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        /* Fix untuk sticky toast pada mobile */
        @media (max-width: 640px) {
            #toastContainer {
                bottom: 20px !important;
                right: 16px !important;
                left: 16px !important;
            }
            
            #toastContainer > div {
                width: 100% !important;
                text-align: center !important;
            }
        }

        /* Custom toggle switch styles */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .dark .toggle-switch {
            background: #374151;
        }

        .toggle-switch.active {
            background: #3b82f6;
        }

        .dark .toggle-switch.active {
            background: #6366f1;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        /* Smooth transitions for all interactive elements */
        * {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }
    </style>
</head>
<body class="bg-gradient-light dark:bg-gradient-light animate-gradient min-h-screen text-gray-800 dark:text-gray-100 transition-all duration-300">
    <!-- Header dengan Logo Kampus dan Foto Profil -->
    <header class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-lg border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40 transition-all duration-300">
        <div class="container mx-auto max-w-5xl px-3 sm:px-4">
            <div class="flex items-center justify-between py-3 sm:py-4">
                <!-- Logo Kampus dan Info -->
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-full flex items-center justify-center shadow-lg p-1 overflow-hidden">
                        <!-- Logo Kampus dari Assets Lokal -->
                        <img 
                            src="assets/icon/global.png" 
                            alt="Logo Kampus" 
                            class="w-full h-full icon-campus rounded-full"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        >
                        <!-- Fallback SVG jika gambar tidak bisa dimuat -->
                        <svg class="w-6 h-6 sm:w-7 sm:h-7 text-white" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                        </svg>
                    </div>
                    <div class="hidden sm:block">
                        <h1 class="text-lg font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent">
                            Universitas Global Institute 
                        </h1>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Sistem Pembayaran Terpadu</p>
                    </div>
                </div>

                <!-- Kontrol Tengah -->
                <div class="flex items-center space-x-4">
                    <!-- Dark/Light Mode Toggle -->
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <div id="themeToggle" class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                        <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </div>
                </div>

                <!-- Foto Profil dan Info User -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <div class="hidden sm:block text-right">
                        <p class="text-sm font-medium text-gray-800 dark:text-gray-200">Admin</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">admin@admin.com</p>
                    </div>
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-accent-400 to-primary-500 rounded-full shadow-lg cursor-pointer hover:shadow-xl transition-all duration-300 transform hover:scale-105 overflow-hidden">
                        <!-- Foto Profil dari Assets Lokal -->
                        <img 
                            src="assets/icon/profil.gif" 
                            alt="Foto Profil" 
                            class="w-full h-full icon-profile rounded-full"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        >
                        <!-- Fallback SVG jika gambar tidak bisa dimuat -->
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Kontainer utama aplikasi -->
    <div class="container mx-auto max-w-5xl px-3 sm:px-4 py-4 sm:py-8">
        <!-- Bagian judul aplikasi -->
        <div class="text-center mb-6 sm:mb-8 animate-fade-up" style="animation-delay: 100ms;">
            <h1 class="mobile-title text-2xl sm:text-4xl font-extrabold mb-2 tracking-tight bg-gradient-to-r from-primary-600 via-secondary-600 to-accent-600 bg-clip-text text-transparent">
                Sistem Pembayaran Modern
            </h1>
            <p class="mobile-subtitle text-sm sm:text-base text-gray-600 dark:text-gray-400">
                Kelola transaksi dengan antarmuka yang lebih baik
            </p>
        </div>

        <!-- Grid layout untuk formulir dan riwayat transaksi - Mobile First -->
        <div class="flex flex-col lg:grid lg:grid-cols-5 gap-4 sm:gap-8">
            <!-- Form Pembayaran -->
            <div class="w-full lg:col-span-2 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-700/20 p-4 sm:p-6 animate-fade-up transition-all duration-300 hover:shadow-2xl" style="animation-delay: 200ms;">
                <div class="flex items-center mb-4 sm:mb-6">
                    <!-- Icon Kartu Kredit -->
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                    </div>
                    <h2 class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200">Form Pembayaran</h2>
                </div>

                <form id="paymentForm" class="space-y-3 sm:space-y-4">
                    <input type="text" id="customerName" name="customerName" placeholder="Nama Pelanggan" class="w-full px-3 sm:px-4 py-3 sm:py-2 text-base bg-white/70 dark:bg-gray-700/70 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 focus:border-transparent transition-all duration-300 placeholder-gray-500 dark:placeholder-gray-400 text-gray-800 dark:text-gray-200" required>
                    
                    <input type="email" id="customerEmail" name="customerEmail" placeholder="Email Pelanggan" class="w-full px-3 sm:px-4 py-3 sm:py-2 text-base bg-white/70 dark:bg-gray-700/70 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 focus:border-transparent transition-all duration-300 placeholder-gray-500 dark:placeholder-gray-400 text-gray-800 dark:text-gray-200" required>
                    
                    <select id="productSelect" name="product" class="w-full px-3 sm:px-4 py-3 sm:py-2 text-base bg-white/70 dark:bg-gray-700/70 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 focus:border-transparent transition-all duration-300 text-gray-800 dark:text-gray-200" required>
                        <option value="">Pilih produk...</option>
                        <option value="basic" data-price="50000">Paket Basic - Rp 50.000</option>
                        <option value="premium" data-price="100000">Paket Premium - Rp 100.000</option>
                        <option value="professional" data-price="200000">Paket Professional - Rp 200.000</option>
                        <option value="enterprise" data-price="500000">Paket Enterprise - Rp 500.000</option>
                    </select>
                    
                    <input type="number" id="quantity" name="quantity" min="1" max="100" value="1" class="w-full px-3 sm:px-4 py-3 sm:py-2 text-base bg-white/70 dark:bg-gray-700/70 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 focus:border-transparent transition-all duration-300 placeholder-gray-500 dark:placeholder-gray-400 text-gray-800 dark:text-gray-200" required>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Metode Pembayaran</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                            <label class="payment-method-label flex items-center p-3 sm:p-2 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-white/80 dark:hover:bg-gray-700/80 hover:border-primary-400 dark:hover:border-secondary-400 transition-all duration-300 cursor-pointer">
                                <input type="radio" name="paymentMethod" value="transfer" class="text-primary-600 dark:text-secondary-500 focus:ring-primary-500 dark:focus:ring-secondary-500 w-4 h-4 sm:w-auto sm:h-auto" required>
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Transfer Bank</span>
                            </label>
                            <label class="payment-method-label flex items-center p-3 sm:p-2 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-white/80 dark:hover:bg-gray-700/80 hover:border-primary-400 dark:hover:border-secondary-400 transition-all duration-300 cursor-pointer">
                                <input type="radio" name="paymentMethod" value="ewallet" class="text-primary-600 dark:text-secondary-500 focus:ring-primary-500 dark:focus:ring-secondary-500 w-4 h-4 sm:w-auto sm:h-auto" required>
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">E-Wallet</span>
                            </label>
                            <label class="payment-method-label flex items-center p-3 sm:p-2 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-white/80 dark:hover:bg-gray-700/80 hover:border-primary-400 dark:hover:border-secondary-400 transition-all duration-300 cursor-pointer">
                                <input type="radio" name="paymentMethod" value="credit" class="text-primary-600 dark:text-secondary-500 focus:ring-primary-500 dark:focus:ring-secondary-500 w-4 h-4 sm:w-auto sm:h-auto" required>
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Kartu Kredit</span>
                            </label>
                            <label class="payment-method-label flex items-center p-3 sm:p-2 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-white/80 dark:hover:bg-gray-700/80 hover:border-primary-400 dark:hover:border-secondary-400 transition-all duration-300 cursor-pointer">
                                <input type="radio" name="paymentMethod" value="cash" class="text-primary-600 dark:text-secondary-500 focus:ring-primary-500 dark:focus:ring-secondary-500 w-4 h-4 sm:w-auto sm:h-auto" required>
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Bayar Tunai</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label for="promoCode" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Kode Promo</label>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="promoCode" name="promoCode" placeholder="Masukkan kode promo" class="flex-1 px-3 sm:px-4 py-3 sm:py-2 text-base bg-white/70 dark:bg-gray-700/70 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 focus:border-transparent transition-all duration-300 placeholder-gray-500 dark:placeholder-gray-400 text-gray-800 dark:text-gray-200">
                            <button type="button" id="applyPromoBtn" class="w-full sm:w-auto px-4 py-3 sm:py-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300 text-sm shadow-lg hover:shadow-xl transform hover:scale-105">
                                Terapkan
                            </button>
                        </div>
                    </div>

                    <!-- Ringkasan pembayaran -->
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 rounded-xl p-3 sm:p-4 mt-4 space-y-2 border border-gray-200 dark:border-gray-600">
                        <div class="flex justify-between items-center text-sm text-gray-600 dark:text-gray-400">
                            <span>Subtotal</span>
                            <span id="subtotal" class="font-medium">Rp 0</span>
                        </div>
                        <div id="discountRow" class="flex justify-between items-center text-sm text-green-600 dark:text-green-400 hidden">
                            <span>Diskon</span>
                            <span id="discount" class="font-medium">Rp 0</span>
                        </div>
                        <div class="flex justify-between items-center text-lg sm:text-xl font-bold text-gray-800 dark:text-gray-200 border-t border-gray-300 dark:border-gray-600 pt-2 mt-2">
                            <span>Total</span>
                            <span id="totalAmount" class="bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent">Rp 0</span>
                        </div>
                    </div>

                    <button type="submit" id="submitButton" class="w-full flex justify-center items-center py-4 sm:py-3 bg-gradient-to-r from-primary-500 via-secondary-500 to-accent-500 hover:from-primary-600 hover:via-secondary-600 hover:to-accent-600 text-white font-semibold rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-secondary-500 transition-all duration-300 text-base shadow-lg hover:shadow-xl transform hover:scale-105">
                        <span id="buttonText">Proses Pembayaran</span>
                        <!-- Spinner untuk loading state -->
                        <svg id="buttonSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>

            <!-- Riwayat Transaksi -->
            <div class="w-full lg:col-span-3 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-700/20 p-4 sm:p-6 animate-fade-up transition-all duration-300 hover:shadow-2xl" style="animation-delay: 300ms;">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-2">
                    <div class="flex items-center">
                        <!-- Icon Dokumen -->
                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200">Riwayat Transaksi</h2>
                    </div>
                    <button id="clearHistoryBtn" class="w-full sm:w-auto px-3 py-2 text-sm bg-gradient-to-r from-red-100 to-red-200 dark:from-red-800 dark:to-red-900 text-red-700 dark:text-red-300 rounded-xl hover:from-red-200 hover:to-red-300 dark:hover:from-red-700 dark:hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-300 hidden shadow-md hover:shadow-lg transform hover:scale-105">
                        Hapus Riwayat
                    </button>
                </div>
                
                <!-- Statistik transaksi -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-4">
                    <div class="text-center p-3 bg-gradient-to-br from-blue-50 to-primary-100 dark:from-blue-900 dark:to-primary-800 rounded-xl border border-blue-200 dark:border-blue-700">
                        <div class="text-xl sm:text-2xl font-bold text-primary-600 dark:text-primary-400" id="totalTransactions">0</div>
                        <div class="text-xs sm:text-sm text-primary-700 dark:text-primary-300">Transaksi</div>
                    </div>
                    <div class="text-center p-3 bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-900 dark:to-emerald-800 rounded-xl border border-green-200 dark:border-green-700">
                        <div class="text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400" id="totalRevenue">Rp 0</div>
                        <div class="text-xs sm:text-sm text-green-700 dark:text-green-300">Pendapatan</div>
                    </div>
                    <div class="text-center p-3 bg-gradient-to-br from-purple-50 to-secondary-100 dark:from-purple-900 dark:to-secondary-800 rounded-xl border border-purple-200 dark:border-purple-700">
                        <div class="text-xl sm:text-2xl font-bold text-secondary-600 dark:text-secondary-400" id="avgTransaction">Rp 0</div>
                        <div class="text-xs sm:text-sm text-secondary-700 dark:text-secondary-300">Rata-rata</div>
                    </div>
                </div>

                <!-- Tabel riwayat transaksi dengan scroll horizontal di mobile -->
                <div class="table-container overflow-x-auto -mx-1 sm:mx-0 rounded-xl">
                    <table class="w-full text-sm text-left min-w-full">
                        <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 sticky top-0 border-b border-gray-300 dark:border-gray-600">
                            <tr>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[100px] font-semibold">ID Transaksi</th>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[120px] font-semibold">Pelanggan</th>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[120px] font-semibold">Produk</th>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[100px] font-semibold">Total</th>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[100px] font-semibold">Metode</th>
                                <th scope="col" class="px-2 sm:px-4 py-3 min-w-[80px] font-semibold">Waktu</th>
                            </tr>
                        </thead>
                        <tbody id="transactionList">
                            <!-- Riwayat transaksi akan dirender di sini oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Pembayaran Berhasil -->
    <div id="paymentModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 opacity-0 scale-95 transition-all duration-300 pointer-events-none">
        <div class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/20 p-4 sm:p-6 max-w-md w-full max-h-screen overflow-y-auto">
            <div class="text-center mb-4">
                <div class="w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <!-- Icon Centang -->
                    <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Pembayaran Berhasil!</h3>
                <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Transaksi Anda telah berhasil diproses.</p>
            </div>
            <div id="paymentDetails" class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 rounded-xl p-3 sm:p-4 mb-4 sm:mb-6 text-sm border border-gray-200 dark:border-gray-600"></div>
            <button id="closeModalBtn" class="w-full py-3 sm:py-2 bg-gradient-to-r from-primary-500 to-secondary-500 hover:from-primary-600 hover:to-secondary-600 text-white font-semibold rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-secondary-500 transition-all duration-300 text-base shadow-lg hover:shadow-xl transform hover:scale-105">
                Tutup
            </button>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Hapus Riwayat -->
    <div id="confirmModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 opacity-0 scale-95 transition-all duration-300 pointer-events-none">
        <div class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/20 p-4 sm:p-6 max-w-sm w-full text-center max-h-screen overflow-y-auto">
            <div class="w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                <!-- Icon Peringatan -->
                <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.332 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Hapus Riwayat Transaksi?</h3>
            <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-4 sm:mb-6">Anda yakin ingin menghapus semua riwayat transaksi? Tindakan ini tidak dapat dibatalkan.</p>
            <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3">
                <button id="cancelConfirmBtn" class="w-full sm:w-auto px-4 py-3 sm:py-2 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700 text-gray-800 dark:text-gray-200 font-semibold rounded-xl hover:from-gray-300 hover:to-gray-400 dark:hover:from-gray-500 dark:hover:to-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-all duration-300 text-base shadow-md hover:shadow-lg transform hover:scale-105">
                    Batal
                </button>
                <button id="confirmClearBtn" class="w-full sm:w-auto px-4 py-3 sm:py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-300 text-base shadow-lg hover:shadow-xl transform hover:scale-105">
                    Hapus
                </button>
            </div>
        </div>
    </div>

    <!-- Kontainer untuk Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-5 right-5 z-50 space-y-3"></div>

    <!-- Template untuk baris transaksi baru di tabel -->
    <template id="transactionTemplate">
        <tr class="bg-white/50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700 hover:bg-white/80 dark:hover:bg-gray-800/80 transition-all duration-300">
            <td class="px-2 sm:px-4 py-3 font-mono text-xs transaction-id text-gray-800 dark:text-gray-200"></td>
            <td class="px-2 sm:px-4 py-3 font-medium transaction-customer text-xs sm:text-sm text-gray-800 dark:text-gray-200"></td>
            <td class="px-2 sm:px-4 py-3 text-gray-600 dark:text-gray-400 transaction-product text-xs sm:text-sm"></td>
            <td class="px-2 sm:px-4 py-3 font-semibold transaction-amount text-xs sm:text-sm text-gray-800 dark:text-gray-200"></td>
            <td class="px-2 sm:px-4 py-3"><span class="transaction-method px-2 py-1 rounded-full text-xs"></span></td>
            <td class="px-2 sm:px-4 py-3 text-gray-500 dark:text-gray-400 transaction-time text-xs"></td>
        </tr>
    </template>
    
    <!-- Template untuk tampilan kosong di riwayat transaksi -->
    <template id="emptyStateTemplate">
        <tr>
            <td colspan="6" class="text-center py-8 sm:py-10 text-gray-500 dark:text-gray-400">
                <!-- Icon Dokumen Kosong -->
                <svg class="w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-2 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <p class="font-medium text-sm sm:text-base">Belum ada transaksi</p>
                <p class="text-xs sm:text-sm">Silakan lakukan pembayaran pertama Anda.</p>
            </td>
        </tr>
    </template>

    <!-- Script JavaScript utama dengan fitur dark mode (sama seperti sebelumnya) -->
    <script>
        // Memastikan DOM telah dimuat sepenuhnya sebelum menjalankan script
        document.addEventListener('DOMContentLoaded', function() {

            // ===== DARK MODE MANAGEMENT =====
            const themeToggle = document.getElementById('themeToggle');
            const htmlElement = document.documentElement;
            
            // Cek tema yang tersimpan di localStorage atau default ke light mode
            const currentTheme = localStorage.getItem('theme') || 'light';
            
            // Terapkan tema yang tersimpan
            if (currentTheme === 'dark') {
                htmlElement.classList.add('dark');
                themeToggle.classList.add('active');
            }
            
            // Event listener untuk toggle tema
            themeToggle.addEventListener('click', function() {
                if (htmlElement.classList.contains('dark')) {
                    htmlElement.classList.remove('dark');
                    themeToggle.classList.remove('active');
                    localStorage.setItem('theme', 'light');
                } else {
                    htmlElement.classList.add('dark');
                    themeToggle.classList.add('active');
                    localStorage.setItem('theme', 'dark');
                }
            });

            // ===== DATA & VARIABEL GLOBAL =====
            // Inisialisasi daftar transaksi, akan diisi dari localStorage
            let transactions = [];
            
            // Daftar kode promo yang tersedia
            const promoCodes = {
                "DISKON10": { type: "percentage", discount: 10, description: "Potongan 10%" },
                "HEMAT50K": { type: "fixed", discount: 50000, description: "Diskon tetap Rp 50.000" },
                "STUDENT20": { type: "percentage", discount: 20, description: "Diskon 20% khusus pelajar" }
            };

            // Mapping warna Tailwind CSS untuk metode pembayaran
            const paymentMethodColors = {
                'transfer': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',
                'ewallet': 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300',
                'credit': 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300',
                'cash': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300'
            };

            // Mapping nama tampilan untuk metode pembayaran
            const paymentMethodNames = {
                'transfer': 'Transfer Bank',
                'ewallet': 'E-Wallet',
                'credit': 'Kartu Kredit',
                'cash': 'Bayar Tunai'
            };

            // Objek untuk menyimpan state aplikasi saat ini
            let appState = { currentDiscount: 0, appliedPromoCode: '' };

            // ===== MENDAPATKAN ELEMEN DOM =====
            const paymentForm = document.getElementById('paymentForm');
            const productSelect = document.getElementById('productSelect');
            const quantity = document.getElementById('quantity');
            const promoCodeInput = document.getElementById('promoCode');
            const applyPromoBtn = document.getElementById('applyPromoBtn');
            
            const subtotalEl = document.getElementById('subtotal');
            const discountEl = document.getElementById('discount');
            const discountRow = document.getElementById('discountRow');
            const totalAmountEl = document.getElementById('totalAmount');
            
            const transactionList = document.getElementById('transactionList');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            
            const totalTransactionsEl = document.getElementById('totalTransactions');
            const totalRevenueEl = document.getElementById('totalRevenue');
            const avgTransactionEl = document.getElementById('avgTransaction');
            
            const paymentModal = document.getElementById('paymentModal');
            const paymentDetails = document.getElementById('paymentDetails');
            const closeModalBtn = document.getElementById('closeModalBtn');

            const confirmModal = document.getElementById('confirmModal');
            const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
            const confirmClearBtn = document.getElementById('confirmClearBtn');

            const submitButton = document.getElementById('submitButton');
            const buttonText = document.getElementById('buttonText');
            const buttonSpinner = document.getElementById('buttonSpinner');
            
            const toastContainer = document.getElementById('toastContainer');

            // ===== FUNGSI UTILITY & UI =====

            /**
             * Memformat angka menjadi format mata uang Rupiah.
             * @param {number} amount - Jumlah yang akan diformat.
             * @returns {string} - String mata uang yang diformat.
             */
            const formatCurrency = amount => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);

            /**
             * Mendapatkan waktu saat ini dalam format HH:MM.
             * @returns {string} - Waktu saat ini.
             */
            const getCurrentTime = () => new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            /**
             * Menghasilkan ID transaksi unik.
             * @returns {string} - ID transaksi.
             */
            const generateTransactionId = () => 'TRX-' + Date.now().toString().slice(-6);

            /**
             * Validasi format email.
             * @param {string} email - Email yang akan divalidasi.
             * @returns {boolean} - True jika email valid.
             */
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            /**
             * Menampilkan notifikasi toast dengan tema yang sesuai.
             * @param {string} message - Pesan yang akan ditampilkan.
             * @param {'success'|'error'} type - Tipe notifikasi (sukses atau error).
             */
            function showToast(message, type = 'success') {
                const bgColor = type === 'success' 
                    ? 'bg-gradient-to-r from-green-500 to-emerald-600' 
                    : 'bg-gradient-to-r from-red-500 to-red-600';
                const toast = document.createElement('div');
                toast.className = `w-auto px-6 py-3 rounded-xl shadow-lg text-white ${bgColor} animate-slide-in-down backdrop-blur-md border border-white/20`;
                toast.textContent = message;
                toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.classList.remove('animate-slide-in-down');
                    toast.classList.add('animate-fade-out');
                    toast.addEventListener('animationend', () => toast.remove());
                }, 3000);
            }

            /**
             * Menampilkan atau menyembunyikan modal.
             * @param {HTMLElement} modalElement - Elemen modal yang akan diatur.
             * @param {boolean} show - True untuk menampilkan, false untuk menyembunyikan.
             */
            function toggleModal(modalElement, show) {
                if (show) {
                    modalElement.classList.add('modal-active');
                } else {
                    modalElement.classList.remove('modal-active');
                }
            }

            // ===== FUNGSI PENYIMPANAN DATA (LOCALSTORAGE) =====

            /**
             * Memuat data transaksi dari localStorage.
             */
            function loadTransactions() {
                try {
                    const storedTransactions = localStorage.getItem('modernPaymentTransactions');
                    if (storedTransactions) {
                        transactions = JSON.parse(storedTransactions);
                    }
                } catch (error) {
                    console.error("Gagal memuat transaksi dari localStorage:", error);
                    transactions = [];
                    showToast('Gagal memuat data transaksi. Data telah direset.', 'error');
                }
            }

            /**
             * Menyimpan data transaksi ke localStorage.
             */
            function saveTransactions() {
                try {
                    localStorage.setItem('modernPaymentTransactions', JSON.stringify(transactions));
                } catch (error) {
                    console.error("Gagal menyimpan transaksi ke localStorage:", error);
                    showToast('Gagal menyimpan data transaksi.', 'error');
                }
            }

            // ===== FUNGSI KALKULASI =====

            /**
             * Menghitung subtotal berdasarkan produk dan kuantitas yang dipilih.
             * @returns {number} - Nilai subtotal.
             */
            function calculateSubtotal() {
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                if (!selectedOption || !selectedOption.dataset.price) return 0;

                const price = parseInt(selectedOption.dataset.price, 10);
                const qty = parseInt(quantity.value, 10) || 1;
                return price * qty;
            }

            /**
             * Menghitung diskon berdasarkan subtotal dan data promo.
             * @param {number} subtotal - Nilai subtotal.
             * @param {object | null} promoData - Objek data promo atau null jika tidak ada.
             * @returns {number} - Nilai diskon yang dihitung.
             */
            function calculateDiscount(subtotal, promoData) {
                if (!promoData) return 0;

                if (promoData.type === 'percentage') {
                    return Math.round(subtotal * promoData.discount / 100);
                } else if (promoData.type === 'fixed') {
                    return Math.min(promoData.discount, subtotal);
                }
                return 0;
            }

            /**
             * Memperbarui tampilan subtotal, diskon, dan total pembayaran.
             */
            function updateTotal() {
                const subtotal = calculateSubtotal();
                const promoData = appState.appliedPromoCode ? promoCodes[appState.appliedPromoCode] : null;
                const discount = calculateDiscount(subtotal, promoData);
                const total = subtotal - discount;

                subtotalEl.textContent = formatCurrency(subtotal);
                if (discount > 0) {
                    discountEl.textContent = '-' + formatCurrency(discount);
                    discountRow.classList.remove('hidden');
                } else {
                    discountRow.classList.add('hidden');
                }
                totalAmountEl.textContent = formatCurrency(total);
                appState.currentDiscount = discount;
            }

            // ===== FUNGSI PROMO & TRANSAKSI =====

            /**
             * Menerapkan kode promo yang dimasukkan pengguna.
             */
            function applyPromoCode() {
                const code = promoCodeInput.value.trim().toUpperCase();
                
                if (!code) {
                    showToast('Masukkan kode promo!', 'error');
                    return;
                }

                if (!promoCodes[code]) {
                    showToast('Kode promo tidak valid!', 'error');
                    appState.appliedPromoCode = '';
                    updateTotal();
                    return;
                }

                appState.appliedPromoCode = code;
                updateTotal();
                showToast(`Promo "${code}" berhasil diterapkan: ${promoCodes[code].description}`);
            }

            /**
             * Mengatur ulang formulir pembayaran dan state aplikasi.
             */
            function resetFormState() {
                paymentForm.reset();
                appState = { currentDiscount: 0, appliedPromoCode: '' };
                updateTotal();
            }

            // ===== RENDER & DOM MANIPULATION =====

            /**
             * Merender daftar transaksi ke tabel.
             */
            function renderTransactions() {
                transactionList.innerHTML = '';
                if (transactions.length === 0) {
                    const emptyTemplate = document.getElementById('emptyStateTemplate');
                    transactionList.appendChild(emptyTemplate.content.cloneNode(true));
                    clearHistoryBtn.classList.add('hidden');
                } else {
                    clearHistoryBtn.classList.remove('hidden');
                    transactions.slice().reverse().forEach(transaction => {
                        const template = document.getElementById('transactionTemplate');
                        const clone = template.content.cloneNode(true);
                        const row = clone.querySelector('tr');

                        row.querySelector('.transaction-id').textContent = transaction.id;
                        row.querySelector('.transaction-customer').textContent = transaction.customerName;
                        row.querySelector('.transaction-product').textContent = `${transaction.product.split(' - ')[0]} (${transaction.quantity}x)`;
                        row.querySelector('.transaction-amount').textContent = formatCurrency(transaction.total);
                        
                        const methodEl = row.querySelector('.transaction-method');
                        methodEl.textContent = paymentMethodNames[transaction.paymentMethod];
                        methodEl.className = `transaction-method px-2 py-1 rounded-full text-xs ${paymentMethodColors[transaction.paymentMethod]}`;
                        
                        row.querySelector('.transaction-time').textContent = transaction.time;
                        
                        row.classList.add('animate-slide-in-down');
                        transactionList.appendChild(clone);
                    });
                }
                updateStatistics();
            }
            
            /**
             * Memperbarui statistik total transaksi, pendapatan, dan rata-rata.
             */
            function updateStatistics() {
                const totalTrans = transactions.length;
                const totalRev = transactions.reduce((sum, t) => sum + t.total, 0);
                const avgTrans = totalTrans > 0 ? totalRev / totalTrans : 0;

                totalTransactionsEl.textContent = totalTrans;
                totalRevenueEl.textContent = formatCurrency(totalRev);
                avgTransactionEl.textContent = formatCurrency(avgTrans);
            }
            
            // ===== MODAL LOGIC (Pembayaran Berhasil) =====

            /**
             * Menampilkan modal pembayaran berhasil dengan detail transaksi.
             * @param {object} transaction - Objek transaksi yang berhasil.
             */
            function showPaymentSuccessModal(transaction) {
                paymentDetails.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">ID Transaksi:</span><span class="font-medium font-mono text-xs text-gray-800 dark:text-gray-200">${transaction.id}</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Nama:</span><span class="font-medium text-gray-800 dark:text-gray-200">${transaction.customerName}</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Produk:</span><span class="font-medium text-gray-800 dark:text-gray-200">${transaction.product}</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Metode:</span><span class="font-medium text-gray-800 dark:text-gray-200">${paymentMethodNames[transaction.paymentMethod]}</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Total Bayar:</span><span class="font-bold text-green-600 dark:text-green-400">${formatCurrency(transaction.total)}</span></div>
                        <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">Waktu:</span><span class="font-medium text-gray-800 dark:text-gray-200">${transaction.time}</span></div>
                    </div>`;
                toggleModal(paymentModal, true);
            }
            
            /**
             * Menutup modal pembayaran berhasil.
             */
            function closePaymentSuccessModal() {
                toggleModal(paymentModal, false);
            }

            // ===== MODAL LOGIC (Konfirmasi Hapus Riwayat) =====

            /**
             * Menampilkan modal konfirmasi untuk menghapus riwayat transaksi.
             */
            function showClearHistoryConfirmModal() {
                toggleModal(confirmModal, true);
            }

            /**
             * Menutup modal konfirmasi hapus riwayat.
             */
            function closeClearHistoryConfirmModal() {
                toggleModal(confirmModal, false);
            }

            /**
             * Menghapus semua riwayat transaksi.
             */
            function clearAllTransactions() {
                transactions = [];
                saveTransactions();
                renderTransactions();
                showToast('Riwayat transaksi telah dihapus.', 'success');
                closeClearHistoryConfirmModal();
            }

            // ===== MAIN LOGIC & EVENT LISTENERS =====

            /**
             * Handler untuk pengiriman formulir pembayaran.
             * @param {Event} e - Objek event.
             */
            async function handlePaymentSubmit(e) {
                e.preventDefault();
                
                const formData = new FormData(paymentForm);
                const selectedProductOption = productSelect.options[productSelect.selectedIndex];

                // Validasi input yang diperluas
                if (!selectedProductOption || !selectedProductOption.value) {
                    showToast('Pilih produk terlebih dahulu!', 'error');
                    return;
                }
                
                const customerName = formData.get('customerName').trim();
                const customerEmail = formData.get('customerEmail').trim();
                const paymentMethod = formData.get('paymentMethod');
                const quantityValue = parseInt(formData.get('quantity'), 10);
                
                if (!customerName) {
                    showToast('Nama pelanggan tidak boleh kosong!', 'error');
                    return;
                }
                if (!customerEmail) {
                    showToast('Email pelanggan tidak boleh kosong!', 'error');
                    return;
                }
                if (!isValidEmail(customerEmail)) {
                    showToast('Format email tidak valid!', 'error');
                    return;
                }
                if (!paymentMethod) {
                    showToast('Pilih metode pembayaran!', 'error');
                    return;
                }
                if (!quantityValue || quantityValue < 1 || quantityValue > 100) {
                    showToast('Kuantitas harus antara 1-100!', 'error');
                    return;
                }
                
                const subtotal = calculateSubtotal();
                if (subtotal <= 0) {
                    showToast('Jumlah pembayaran tidak valid. Pastikan produk dan kuantitas benar.', 'error');
                    return;
                }

                // Aktifkan loading state pada tombol
                buttonText.classList.add('hidden');
                buttonSpinner.classList.remove('hidden');
                submitButton.disabled = true;
                submitButton.classList.add('opacity-75', 'cursor-not-allowed');

                try {
                    // Simulasi delay jaringan/pemrosesan API
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    const transaction = {
                        id: generateTransactionId(),
                        customerName: customerName,
                        customerEmail: customerEmail,
                        product: selectedProductOption.textContent,
                        quantity: quantityValue,
                        paymentMethod: paymentMethod,
                        total: subtotal - appState.currentDiscount,
                        time: getCurrentTime()
                    };

                    transactions.push(transaction);
                    saveTransactions();
                    
                    showPaymentSuccessModal(transaction);
                    renderTransactions();
                    resetFormState();
                    showToast('Pembayaran berhasil diproses!', 'success');

                } catch (error) {
                    console.error("Error saat memproses pembayaran:", error);
                    showToast('Terjadi kesalahan saat memproses pembayaran. Coba lagi.', 'error');
                } finally {
                    // Nonaktifkan loading state pada tombol
                    buttonText.classList.remove('hidden');
                    buttonSpinner.classList.add('hidden');
                    submitButton.disabled = false;
                    submitButton.classList.remove('opacity-75', 'cursor-not-allowed');
                }
            }

            /**
             * Mengikat semua event listener ke elemen DOM.
             */
            function bindEventListeners() {
                // Event listener untuk perubahan produk atau kuantitas untuk memperbarui total
                ['change', 'input'].forEach(evt => {
                    productSelect.addEventListener(evt, updateTotal);
                    quantity.addEventListener(evt, updateTotal);
                });
                
                // Event listener untuk tombol 'Terapkan' promo
                applyPromoBtn.addEventListener('click', applyPromoCode);
                // Event listener untuk menekan 'Enter' di input promo
                promoCodeInput.addEventListener('keypress', e => { 
                    if (e.key === 'Enter') { 
                        e.preventDefault();
                        applyPromoCode(); 
                    }
                });
                
                // Event listener untuk submit formulir pembayaran
                paymentForm.addEventListener('submit', handlePaymentSubmit);

                // Event listener untuk tombol 'Tutup' pada modal pembayaran berhasil
                closeModalBtn.addEventListener('click', closePaymentSuccessModal);
                // Event listener untuk klik di luar area modal pembayaran berhasil (overlay)
                paymentModal.addEventListener('click', e => { 
                    if (e.target === paymentModal) closePaymentSuccessModal(); 
                });
                // Event listener untuk menekan tombol 'Escape' untuk menutup modal
                document.addEventListener('keydown', e => { 
                    if (e.key === 'Escape') {
                        closePaymentSuccessModal();
                        closeClearHistoryConfirmModal();
                    }
                });
                
                // Event listener untuk tombol 'Hapus Riwayat'
                clearHistoryBtn.addEventListener('click', showClearHistoryConfirmModal);

                // Event listener untuk tombol 'Batal' di modal konfirmasi
                cancelConfirmBtn.addEventListener('click', closeClearHistoryConfirmModal);
                // Event listener untuk tombol 'Hapus' di modal konfirmasi
                confirmClearBtn.addEventListener('click', clearAllTransactions);
                
                // Event listener untuk klik di luar area modal konfirmasi (overlay)
                confirmModal.addEventListener('click', e => { 
                    if (e.target === confirmModal) closeClearHistoryConfirmModal(); 
                });
            }

            /**
             * Fungsi inisialisasi aplikasi.
             */
            function init() {
                loadTransactions(); // Muat transaksi dari localStorage
                renderTransactions(); // Render daftar transaksi
                updateTotal(); // Perbarui total pembayaran
                bindEventListeners(); // Ikat event listeners
                
                // Log sukses untuk debugging
                console.log('Sistem Pembayaran Modern berhasil diinisialisasi');
                console.log('Tema saat ini:', currentTheme);
                console.log('Kode promo tersedia:', Object.keys(promoCodes));
            }

            // Jalankan inisialisasi
            init();
        });
    </script>
</body>
</html>
